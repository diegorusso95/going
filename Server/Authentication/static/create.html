<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <title>Create</title>
  <link rel="stylesheet" href="/static/going.css">
  <link rel="stylesheet" href="/static/create.css">

</head>
<script type="module" src="/static/create_roadmap.js"></script>
<link rel="stylesheet" href="/static/roadmap.css">
<script>

  /*function addToRoadmapVisual(stage) {
    document.getElementById('stage_list').innerHTML += "üèÅ" + stage.name + " -> " + stage.durata + "<br>"
  }*/


  function ricercaCitta() {
    /*
    mappa da richiedere con dati in campo id="citta_search"
    */
  }

  function submitRoadmap(roadmap) {
    var tagValue, title, description, dateNow
    allTime = parseInt(document.getElementById("somma_totale").innerText)
    var isPub = 1
    var visibilita = document.querySelector('input[name="visibilita"]:checked').value;
    console.log("visibilit√†: ", visibilita)
    if (visibilita == "Privata") {
      isPub = 0
    }
    console.log("isPub: ", isPub)


    title = document.getElementById("titolo").value
    console.log("titolo: ", title);
    description = document.getElementById("descrizione").value
    console.log("descrizione: ", description);

    console.log("lenght rm: ", roadmap.length);
    console.log(roadmap)


    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth() + 1; //January is 0!
    var yyyy = today.getFullYear();
    today = yyyy + '-' + mm + '-' + dd;
    console.log(today)

    if (title == "") {
      alert("Titolo vuoto")
    }
    else if (roadmap.length < 2) {
      alert("almeno due stage")
    }
    else {
      var xhr = new XMLHttpRequest();
      xhr.open("POST", '/createRoadmap', true);
      xhr.onload = function (event) {

        const r = JSON.parse(event.target.responseText);

        if (r.ok == true) {
          alert("creata la roadmap")
        }
        else if (r.ok == false) {
          alert("Problemi creazione roadmap")
        }
      }

      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({
        titolo: title,
        descrizione: description,
        isPublic: isPub,
        localita: roadmap[0].citta,
        stages: roadmap
      }));
    }
  }

</script>

<body>

  <div class="header">
    <a href="/">
      <h1>GOING</h1>


      <img class="logo_nostro" src="/storage/logo.png" alt="logo">

      <p>Where you want to go, the roads you want to take</p>
    </a>
  </div>

  <div class="navbar">
    <a href="/">Homepage</a>
    <a href="/about">About</a>
    <a href="/explore">Explore</a>
    <a href="/create">Create</a>
    <a href="/login" class="right">Sign Up/Login</a>

  </div>

  <div class="contenuto">
    <br>--DA FARE--<br>
    barra ricerca citt√† permette onclick mappa su quella citta<br>

    <br>
    <h2 style="text-align:center">
      Benvenuto nella pagina creazione Roadmap <div id="nome_utente"> (inserimento username del loggato) </div>
    </h2>

    <div class="container_up">

      <div class="title_vis">
        <label>
          Titolo
          <input type="text" name="titolo" id="titolo" style="width: 75%;" required>
        </label><br>
        <label class="visibilita">Scegli la visibilita<br>

          <input type="radio" id="pub" name="visibilita" value="Pubblica" checked>
          <label for="pub">Pubblica</label><br>
          <input type="radio" id="priv" name="visibilita" value="Privata">
          <label for="priv">Privata</label><br>
        </label>


      </div>

      <div class="description">
        <label>
          Descrizione<br>
          <input type="text" name="descrizione" id="descrizione" required>
        </label><br>

      </div>

    </div>
    <h2 style="text-align:center">
      Cerca la citt√† in cui vuoi fare una bella Roadmap<br>
      <input type="text" name="citta_search" id="citta_search" placeholder="">
      <input type="submit" value="Avvia Ricerca" onclick="ricercaCitta()">

      <input type="radio" id="driving_mode" name="fav_language" value="DRIVING">
      <label for="driving_mode">Macchina</label><br>
      <input type="radio" id="walking_mode" name="fav_language" value="WALKING" checked>
      <label for="walking_mode">A piedi</label><br>
    </h2>

    <div class="container_middle">
      <div class="mappa_rm">
        <!--The div element for the map -->
        <div id="map"></div>

        <!-- 
     The `defer` attribute causes the callback to execute after the full HTML
     document has been parsed. For non-blocking uses, avoiding race conditions,
     and consistent behavior across browsers, consider loading using Promises
     with https://www.npmjs.com/package/@googlemaps/js-api-loader.
    -->
        <script
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDkhHdG46Po1AyvEnEsk8PALxscMRpEYCs&callback=initMap&v=weekly&libraries=places"
          defer></script>
      </div>


      <div class="all">
        <div class="body-cards">
          <div class="main">

            <div class="cardTop">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M-38.5 196C-38.5 196 34 91 133.5 91C233 91 427 159 532.5 30C638 -99 518 236 518 236L-49 246.5L-38.5 196Z"
                fill="#FF768E" />
              </svg>
            </div>


            <div class="timeline">
              <h3>Durata totale in minuti</h3>
              <label class="durata" id="somma_totale">0</label>
              <div class="box">

                <div class="container">

                  <div class="lines" id="lines">

                  </div>

                  <div class="cards" id="cards"></div>



                </div>




                <div id="submit_btn">

                </div>
              </div>


            </div>
          </div>
        </div>
      </div>

    </div>


    <div class="container_bottom">



     

    </div>







  </div>
  <div class="footer">

    <h4>
      Copyright 2022
    </h4>

    <h6>
      Diego-Gian Marco-Marco-Matteo-Valerio
    </h6>
  </div>
</body>