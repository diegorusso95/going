<!DOCTYPE html>
<html>

<head>
  <title>Create-Going</title>
  <meta charset="utf-8" />
  <meta name="description"
    content="Programma la tua esperienza di viaggio creando la tua roadmap oppure scegliendo tra le pi√π belle della community!">
  <meta name="author" content="Mennillo Orlando Perillo Russo Maraniello" />
  <meta name="keywords" content="Going, going, viaggi, travel, roadmap" />
  <link rel="icon" href="/storage/favicon.jpg" type="image/jpg" />

  <link rel="stylesheet" href="/static/going.css">
  <link rel="stylesheet" href="/static/Explore.css">
  <link rel="stylesheet" href="/static/header.css">
  <link rel="stylesheet" href="/static/create.css">
  <link rel="stylesheet" href="/static/roadmap.css">

  <script src="/static/MapUtils.js" type="text/javascript"></script>
  <script src="/static/Login.js" type="text/javascript"></script>
  <script src="/static/create_roadmap.js" type="text/javascript"></script>
  <script src="/static/header.js" type="text/javascript"></script>
  <script src="/static/Profile.js" type="text/javascript"></script>
  <script src="/static/Explore.js" type="text/javascript"></script>
  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">
</head>


<script>

  /*function addToRoadmapVisual(stage) {
    document.getElementById('stage_list').innerHTML += "üèÅ" + stage.name + " -> " + stage.durata + "<br>"
  }*/


  function ricercaCitta() {
    /*
    mappa da richiedere con dati in campo id="citta_search"
    */
    console.log("ciao citta, posto cercato")
  }

  function submitRoadmap(roadmap) {
    var title, description, dateNow
    allTime = parseInt(document.getElementById("somma_totale").innerText)
    var isPub = 1
    var visibilita = document.querySelector('input[name="visibilita"]:checked').value;
    console.log("visibilit√†: ", visibilita)
    if (visibilita == "Privata") {
      isPub = 0
    }
    console.log("isPub: ", isPub)


    title = document.getElementById("titolo").value
    console.log("titolo: ", title);
    description = document.getElementById("descrizione").value
    console.log("descrizione: ", description);

    console.log("lenght rm: ", roadmap.length);
    console.log(roadmap)


    var today = new Date();
    var dd = today.getDate();
    var mm = today.getMonth() + 1; //January is 0!
    var yyyy = today.getFullYear();
    today = yyyy + '-' + mm + '-' + dd;
    console.log(today)

    if (title == "") {
      alert("Titolo vuoto")
    }
    else if (roadmap.length < 2) {
      alert("almeno due stage")
    }
    else {
      var xhr = new XMLHttpRequest();
      xhr.open("POST", '/createRoadmap', true);
      xhr.onload = function (event) {

        const r = JSON.parse(event.target.responseText);

        if (r.ok == true) {
          alert("creata la roadmap")
          location.href = '/profile'
        }
        else if (r.ok == false) {
          alert("Problemi creazione roadmap")
        }
      }

      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({
        titolo: title,
        descrizione: description,
        isPublic: isPub,
        localita: roadmap[0].citta,
        stages: roadmap
      }));
    }
  }

</script>


<div id="info_nolog">

  <p>
  <h2>NON TI SEI AUTENTICATO NEL SISTEMA!!</h2>
  </p>
  <p>
  <h4>Torna alla home o Registrati</h4>
  </p>


  <input class="pulsantiForm" type="submit" name="home" value="Home" onclick="location.href = '/'">
  <input type="submit" class="pulsantiForm" value="Registrati" onclick="location.href ='/signup'">


</div>


<body id="all_page">

  <!-- INIZIO PARTE LOG LOGOUT E HEADER-->
  <div id="log">
      <p>
      <h2>EFFETTUA IL LOGIN</h2>
      </p>
        
      <p id="Response_Login"> </p>	
    
      <p><input type="text" name="username" id="username_login" placeholder="Username"/></p>
    
      <p><input type="password" name="password" id="password_login" placeholder="Password"/></p>

      <p>
        <input class="pulsantiForm" id="log_puls" type="submit" name="invia" value="Login" onclick="validation_login()"/>
        <input type="button" onclick="document.getElementById('log').style.display='none'" class="pulsantiForm" value="Annulla" />
      </p>


      <p class="noReg">
        Non sei ancora registrato? <a href="/signup">Registrati qui</a>
      </p>
	</div>

  <div id="logout">
    <p>
    <h2>VUOI EFFETTUARE IL LOGOUT?</h2>
    </p>


    <input class="pulsantiForm" type="submit" name="Logout" value="Logout" onclick="logout()" />
    <input type="button" onclick="document.getElementById('logout').style.display='none'" class="pulsantiForm"
      value="Annulla" />

  </div>

  <!--Nuovo Header-->
  <div class="row1">
    <div class="coloumn-headersx">
      <div class="coloumnLogo">
        <span><img src="/storage/logo.png" id="logo-header" /> </span>
      </div>
      <div class="coloumnTitolo">
        <p> GOING</p>
      </div>
    </div>
    <div class="coloumn-headerdx">
      <div class="topnav">
        <a id="home_header" href="/"> HOMEPAGE</a>
        <a id="info_header" href="/info">INFO</a>
        <a id="about_header" href="/about"> ABOUT </a>
        <a id="explore_header" href="/explore"> EXPLORE </a>
        <a id="create_header" href="/create"> CREATE </a>
      </div>
    </div>
    <div class="topnav_image0" id="topnav_image0">
    </div>
    <div class="topnav_image" id="topnav_image">
      <img id="image_topnav" src="/storage/loginTransp.png"
        onclick="document.getElementById('log').style.display='block'" />
    </div>
  </div>
  <!-- FINE PARTE LOG LOGOUT E HEADER-->



  <div class="contenuto" id="contenuto">

    <br>--DA FARE--<br>
    barra ricerca citt√† permette onclick mappa su quella citta<br>

    <br>
    <h2 style="text-align:center">
      Benvenuto nella pagina creazione Roadmap <div id="nome_utente"> (inserimento username del loggato) </div>
    </h2>

    <div class="container_up">

      <div class="title_vis">
        <label>
          Titolo
          <input type="text" name="titolo" id="titolo" style="width: 75%;" required>
        </label><br>
        <label class="visibilita">Scegli la visibilita<br>

          <input type="radio" id="pub" name="visibilita" value="Pubblica" checked>
          <label for="pub">Pubblica</label><br>
          <input type="radio" id="priv" name="visibilita" value="Privata">
          <label for="priv">Privata</label><br>
        </label>


      </div>

      <div class="description">
        <label>
          Descrizione<br>
          <input type="text" name="descrizione" id="descrizione" required>
        </label><br>

      </div>

    </div>
    <h2 style="text-align:center">
      Cerca la citt√† in cui vuoi fare una bella Roadmap<br>
      <input type="text" name="citta_search" id="citta_search" placeholder="">
      <input type="submit" value="Avvia Ricerca" id="btn_search" onclick="ricercaCitta()">

      <input type="radio" id="driving_mode" name="fav_language" value="DRIVING">
      <label for="driving_mode">Macchina</label><br>
      <input type="radio" id="walking_mode" name="fav_language" value="WALKING" checked>
      <label for="walking_mode">A piedi</label><br>
    </h2>

    <div class="container_middle">
      <div class="mappa_rm">
        <!--The div element for the map -->
        <div id="map"></div>

        <!-- 
     The `defer` attribute causes the callback to execute after the full HTML
     document has been parsed. For non-blocking uses, avoiding race conditions,
     and consistent behavior across browsers, consider loading using Promises
     with https://www.npmjs.com/package/@googlemaps/js-api-loader.
    -->
        <script
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBPAAQaGDsfG0K4lksFbcEetDuNw85mlH8&callback=initMap&v=weekly&libraries=places,geometry"
          defer></script>
      </div>


      <div class="all">
        <div class="body-cards">
          <div class="main">

            <div class="cardTop">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M-38.5 196C-38.5 196 34 91 133.5 91C233 91 427 159 532.5 30C638 -99 518 236 518 236L-49 246.5L-38.5 196Z"
                fill="#FF768E" />
              </svg>
            </div>


            <div class="timeline">
              <h3>Durata totale in minuti</h3>
              <label class="durata" id="somma_totale">0</label>
              <div class="box">

                <div class="container">

                  <div class="lines" id="lines">

                  </div>

                  <div class="cards" id="cards"></div>



                </div>




                <div class="bottom">

                  <div class="btn" id="submit_btn">Conferma Creazione Roadmap</div>

                </div>
              </div>
            </div>


          </div>
        </div>
      </div>


    </div>


    <div class="container_bottom">





    </div>







  </div>
  <div class="footer">

    <h4>
      Copyright 2022
    </h4>

    <h6>
      Diego-Gian Marco-Marco-Matteo-Valerio
    </h6>
  </div>
  <script>
    var input = document.getElementById("citta_search");
    input.addEventListener("keypress", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        document.getElementById("btn_search").click();
      }
    });
  </script>
</body>

</html>