<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <title>Home</title>
  <link rel="stylesheet" href="/static/going.css">
  <link rel="stylesheet" href="/static/Explore.css">

</head>

<script>
  //onclick su submit e poppa in result_rm e result_ut
  /*
  
  */

  /*function myFunc() {
    const parole = ["citta", "start", "finish", "durata", "star"]
  
    fetch("/static/prova.json")
      .then(response => response.json())
      .then(data => {
        console.log(data)
        for (var i = 0; i < data.length; i++) {
          let citta = data[i].citta;
          let start = data[i].start;
          let finish = data[i].finish;
          let durata = data[i].durata;
          let media_valutazioni = data[i].media_valutazioni;

          let j = i + 1
          cit = parole[0].concat(j)
          st = parole[1].concat(j)
          fn = parole[2].concat(j)
          dur = parole[3].concat(j)
          stel = parole[4].concat(j)

          document.getElementById(cit).innerText = citta;
          document.getElementById(st).innerText = start;
          document.getElementById(fn).innerText = finish;
          document.getElementById(dur).innerText = durata;
          funcStar(media_valutazioni, stel);

        }

      })

  }*/
  function myFunc() {
    var ricerca = document.getElementById("search").value;

    if (ricerca == "") {
      alert(" campi  nullo")
    }
    else {
      var xhr = new XMLHttpRequest();
      xhr.open("GET", '/searchUser?username=' + ricerca, true);
      xhr.onload = function (event) {

        const r = JSON.parse(event.target.responseText);
        const result = r.data.results

        if (r.ok == true) {
          alert("ok db ")
         



          
          var elements = document.getElementsByClassName("item-user");
          console.log(elements.length)
          
          for (var i = 0; i < elements.length; i++) {
            console.log(elements[i])
            console.log(i)
            elements[i].innerHTML=""
            
          }
          elements = document.getElementsByClassName("link_user");
          for (var i = 0; i < elements.length; i++) {
            console.log(elements[i])
            console.log(i)
            elements[i].innerHTML=""
            
          }
       
          element = document.getElementById("result");
          if (element != null) {
            element.outerHTML = "";
          }
          //if(r.data.results.lenght)
          if (result.length > 0) {
            const html_code = '<div id="result">Risultati: '+result.length+'!!!</div>'
            const posto = document.getElementById("items-user");
            posto.insertAdjacentHTML("beforeend", html_code)
            for (var i = 0; i < result.length; i++) {
              const html_code = '<a class="link_user" href="/user/' + result[i].username + '"><div class="item-user" ><img src="/storage/' + result[i].username + '.jpg" style="width:20px;height: 20px;"><br>' + result[i].username + '<br></div></a>'
              const posto = document.getElementById("items-user");
              posto.insertAdjacentHTML("beforeend", html_code)
            }
          }
          else {
            const html_code = '<div id="result">Nothing con username '+ricerca+'!!!</div>'
            const posto = document.getElementById("items-user");
            posto.insertAdjacentHTML("beforeend", html_code)
          }
          //location.href = "/profile";
        }
        else if (r.ok == false) {
          console.log(r)
          alert("Problemi col db")
        }
      }

      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send()
      /*xhr.send(JSON.stringify({
        ricerca: username,
      }));*/
    }




  }
</script>

<body>

  <div class="header">
    <a href="/">
      <h1>GOING</h1>


      <img class="logo_nostro" src="/storage/logo.png" alt="logo">

      <p>Where you want to go, the roads you want to take</p>
    </a>
  </div>

  <div class="navbar">
    <a href="/">Homepage</a>
    <a href="/about">About</a>
    <a href="/explore">Explore</a>
    <a href="/create">Create</a>
    <a href="/logout" class="right">Logout</a>

  </div>

  <div class="contenuto">
    <br>--DA FARE--<br>



    1)scroll laterale verso dx anche per gli utenti<br>

    <h2 style="text-align: center;">
      Esplora il mondo attraverso le nostre Roadmap o con gli occhi dei nostri Roadmappers!!<br>
      <div class="search-container">
        <input type="text" placeholder="Inserisci una qualsiasi parola, numero, tag..." name="search" id="search"
          required>
        <button type="submit" onclick="myFunc()"><img src="/storage/search.png" style="width:20px;height: 20px;"></button>
      </div>
    </h2>







    <div class="grid-container">
      <main class="grid-item main">

        <div class="items" id="items">
          Template RM (onload non c'√® ne sono, poi con onclick tasto, query e si costruiscono)->
          <a href="/roadmpam/id_roadmap">
            <div class="item ">

              titolo senza emoji<br>
              üèô Napoli<br>
              ‚è± 120min<br>
              <img src="/storage/star.jpg" style="width:20px;height: 20px;">Qua stelline solo<br>

            </div>
          </a>


        </div>

      </main>
    </div>


    <div class="grid-container-user">
      <main class="grid-item main-user">

        <div class="items-user" id="items-user">
          Template USER->


        </div>

      </main>
    </div>














  </div>







  </div>



  <div class="footer">

    <h4>
      Copyright 2022
    </h4>

    <h6>
      Diego-Gian Marco-Marco-Matteo-Valerio
    </h6>
  </div>
</body>