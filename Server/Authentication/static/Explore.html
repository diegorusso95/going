<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <title>Home</title>
  <link rel="stylesheet" href="/static/going.css">
  <link rel="stylesheet" href="/static/Explore.css">

</head>

<script>
  //onclick su submit e poppa in result_rm e result_ut
  /*
  
  */
  function richiestaDBRoadmap(ricerca) {
    //qua richiesta rm
    console.log("roadmap da cercare: ", ricerca)
  }
  function richiestaDBUtente(ricerca) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", '/searchUser?username=' + ricerca, true);
    xhr.onload = function (event) {

      const r = JSON.parse(event.target.responseText);
      const result = r.data.results

      if (r.ok == true) {


        element = document.getElementById("numero");
        if (element != null) {
          element.outerHTML = "";
        }

        var elements = document.getElementsByClassName("item-user");
        for (var i = 0; i < elements.length; i++) {
          elements[i].innerHTML = ""

        }

        elements = document.getElementsByClassName("link_user");
        for (var i = 0; i < elements.length; i++) {
          elements[i].innerHTML = ""
        }

        element = document.getElementById("result");
        if (element != null) {
          element.outerHTML = "";
        }

        if (result.length > 0) {
          const html_code = '<div id="numero" style="text-align: center; font-size:25px"><h4>Risultati utenti ha prodotto <div>' + result.length + ' risultato/i</div></h4></div>'
          const posto = document.getElementById("pop_res");
          posto.insertAdjacentHTML("beforeend", html_code)
          for (var i = 0; i < result.length; i++) {
            const html_code = '<a class="link_user" href="/user/' + result[i].username + '"><div class="item-user" ><img src="/storage/' + result[i].username + '.jpg" style="width:20px;height: 20px;"><br>' + result[i].username + '<br></div></a>'
            const posto = document.getElementById("items-user");
            posto.insertAdjacentHTML("beforeend", html_code)
          }
        }
        else {
          const html_code = '<div id="result" style="font-size:25px">Nothing con username ' + ricerca + '!!!</div>'
          const posto = document.getElementById("items-user");
          posto.insertAdjacentHTML("beforeend", html_code)
        }

      }
      else if (r.ok == false) {
        console.log(r)
        alert("Problemi col db")
      }
    }

    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.send()
  }

  function searchExplore() {
    var ricerca = document.getElementById("barra_ricerca").value;

    if (ricerca == "") {
      alert(" campo  nullo")
    }
    else {
      richiestaDBUtente(ricerca), richiestaDBRoadmap(ricerca)
    }
  }

  function fromMain() {

    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const ricerca = urlParams.get('ricerca')

    if (ricerca != null) {
      document.getElementById("barra_ricerca").value = ricerca;
      richiestaDBUtente(ricerca)
      richiestaDBRoadmap(ricerca)
    }
  }
</script>

<body onload="fromMain()">

  <div class="header">
    <a href="/">
      <h1>GOING</h1>


      <img class="logo_nostro" src="/storage/logo.png" alt="logo">

      <p>Where you want to go, the roads you want to take</p>
    </a>
  </div>

  <div class="navbar">
    <a href="/">Homepage</a>
    <a href="/about">About</a>
    <a href="/explore">Explore</a>
    <a href="/create">Create</a>
    <a href="/logout" class="right">Logout</a>

  </div>

  <div class="contenuto">
    <br>--DA FARE--<br>
    1)dato db con roadmap->onclick searcRoamap()<br>

    <h2 style="text-align: center;">
      Esplora il mondo attraverso le nostre Roadmap o con gli occhi dei nostri Roadmappers!!<br>
      <div class="search-container">
        <input type="text" id="barra_ricerca" placeholder="Inserisci una qualsiasi parola, numero, tag..." name="search"
          required>
        <button type="submit" onclick="searchExplore()"><img src="/storage/search.png"
            style="width:20px;height: 20px;"></button>
      </div>
    </h2>

    <div class="grid-container">
      <main class="grid-item main">

        <div class="items" id="items">
          Template RM->
          <a href="/roadmpam/id_roadmap">
            <div class="item ">

              titolo senza emoji<br>
              üèô Napoli<br>
              ‚è± 120min<br>
              <img src="/storage/star.jpg" style="width:20px;height: 20px;">Qua stelline solo<br>

            </div>
          </a>


        </div>

      </main>
    </div>

    <div id="pop_res">

    </div>

    <div class="grid-container-user">

      <main class="grid-item main-user">

        <div class="items-user" id="items-user">



        </div>

      </main>
    </div>














  </div>







  </div>



  <div class="footer">

    <h4>
      Copyright 2022
    </h4>

    <h6>
      Diego-Gian Marco-Marco-Matteo-Valerio
    </h6>
  </div>
</body>